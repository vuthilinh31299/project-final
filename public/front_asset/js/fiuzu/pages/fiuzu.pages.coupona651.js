$(document).ready(function(){var OLD_COUPON_NO='';$('.btn-coupon').click(function(e){e.preventDefault();var coupon_no=$('.coupon-code-input').val();var cart_id=$('.cart-id').val();var old_total_price=parseFloat($('.old-total-price').val());var old_deposit_price=parseFloat($('.old-deposit-price').val());if(OLD_COUPON_NO!=coupon_no){OLD_COUPON_NO=coupon_no;fiuzu.utils.loader.loading('Loading ......');$.ajax({type:'POST',url:'/api/coupon/',dataType:'json',data:{coupon_no:coupon_no,cart_id:cart_id},success:function(data){$('.coupon-group').removeClass('has-error');$('.coupon-error').text('');var couponValue=parseFloat(data['coupon_value']);$('.coupon-total-value').text('-'+fiuzu.utils.convertCurrency(couponValue)+' '+fiuzu.session.currency);$('.coupon-deposit-value').text('-'+fiuzu.utils.convertCurrency(couponValue)+' '+fiuzu.session.currency);if(data.can_deposit){var depositPrice=parseFloat(data['deposit_price']);$('.hide-credit').hide();$('.hide-debit').show();$('.deposit-value').text(fiuzu.utils.convertCurrency(depositPrice)+' '+fiuzu.session.currency);}else{var totalPrice=parseFloat(data['total_price']);$('.hide-credit').show();$('.hide-debit').hide();$('.total-value').text(fiuzu.utils.convertCurrency(totalPrice)+' '+fiuzu.session.currency);}
fiuzu.utils.loader.loaded();},error:function(res){$('.coupon-group').addClass('has-error');var msg_rs=JSON.parse(res.responseText);var couponValue=parseFloat(msg_rs['coupon_value']).toFixed(2);console.log('tesingdsad',couponValue);$('.coupon-error').text(msg_rs['error']);$('.coupon-total-value').text('-'+couponValue+' '+fiuzu.session.currency);$('.coupon-deposit-value').text('-'+couponValue+' '+fiuzu.session.currency);if(msg_rs['can_deposit']){var depositPrice=parseFloat(msg_rs['deposit_price']);$('.hide-credit').hide();$('.hide-debit').show();$('.deposit-value').text(fiuzu.utils.convertCurrency(depositPrice)+' '+fiuzu.session.currency);}else{var totalPrice=parseFloat(msg_rs['total_price']);$('.hide-credit').show();$('.hide-debit').hide();$('.total-value').text(fiuzu.utils.convertCurrency(totalPrice)+' '+fiuzu.session.currency);}
fiuzu.utils.loader.loaded();}});}});});