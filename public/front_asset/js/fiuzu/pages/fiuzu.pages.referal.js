window.allowPopup=false;window.twttr=(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);t._e=[];t.ready=function(f){t._e.push(f);};return t;}(document,"script","twitter-wjs"));var SHAREON_FACEBOOK=1,SHAREON_TWITTER=2,SHAREON_GOOGLE=3,SHAREON_MAIL=4;function submitShareOn(social,params){var form=document.frmShareOn;form.social.value=social;form.params.value=params;form.submit();}
function loadTwitterButton(){twttr.widgets.load();$('.btn-twitter').each(function(){var twttrContestUrl=$(this).attr('data-url'),twttrContestText=$(this).attr('data-text');twttr.widgets.createShareButton(twttrContestUrl,this,{text:twttrContestText,size:'large',count:'none'});twttr.events.bind('tweet',function(ev){if(ev){}});});}
function checkEmail(email){var filter=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!filter.test(email)){if(email.length>0){$('.notice-msg').removeClass("hidden").find("span").html("You have entered an invalid email address.").show();$("#id_email_add").focus();}
return false;}
$('.notice-msg').addClass("hidden");return true;}
function generateList(emails){var i,len,html;var list$=$("#list-emails");list$.html("");for(i=0,len=emails.length;i<len;i++){html='<li><input type="checkbox" name="emails_checked" checked id="email'+i+'" value="'+emails[i]+'" /><label for="email'+i+'"title="'+emails[i]+' ">'+emails[i]+'</label></li>'
list$.append($(html));}}
function authorize(clientId,scopes){gapi.auth.authorize({client_id:clientId,scope:scopes,immediate:false,authuser:""},handleAuthorization);}
function handleAuthorization(authorizationResult){if(authorizationResult&&!authorizationResult.error){var url="https://www.google.com/m8/feeds/contacts/default/thin?alt=json&access_token="+authorizationResult.access_token+"&max-results=1000&v=3.0";$.ajax({url:url,contentType:"application/x-www-form-urlencoded; charset=utf-8",dataType:'json',type:'GET',crossDomain:true,success:function(resp){var modalEmailFriend=new FModalImportContact($("#modal-import-contact"),{data:resp,});modalEmailFriend.show();},error:function(xhr){alert("Error happend. Please contact admin for more information !");}});}}
var googleEmailContacts=[];var emailsAdded=[];var emailsChecked=[];window.FModalImportContact=(function(ParentCls){"use strict";function modalCls(pEl$,options){var obj=new ParentCls(pEl$);var data;var list$;obj.init=function(){list$=$(".list-layout");if(options&&options.data){data=options.data;}
obj.generateListContact();};obj.checkBoxChange=function(){$(".contact-checkbox").change(function(){var count=0;$("input:checkbox[name=import-cb]:checked").each(function(){count++;});if(count>0){var subStr=count==1?" Contact":" Contacts";var str='Import '+count+subStr;$('.import-process').removeClass('disabled');$('.import-process').text(str);}else{$('.import-process').addClass('disabled');$('.import-process').text('Import 0 Contact');}});};obj.checkAll=function(){$('.check-all-checkbox').click(function(){var count=0;var checkboxes=document.getElementsByName('import-cb');for(var i=0,n=checkboxes.length;i<n;i++){checkboxes[i].checked=this.checked;if(this.checked){count++;}}
if(count>0){var subStr=count==1?" Contact":" Contacts";var str='Import '+count+subStr;$('.import-process').removeClass('disabled');$('.import-process').text(str);}else{console.log('dadasdsad');$('.import-process').addClass('disabled');$('.import-process').text('Import 0 Contact');}});};obj.searchContact=function(){var input=document.getElementById('contact-search');input.onkeyup=function(){var hasResult=false;var filter=input.value.toUpperCase();$('#empty-message').addClass('hide');var lis=document.getElementsByClassName('contact-item');for(var i=0;i<lis.length;i++){var name=lis[i].getElementsByClassName('contact-detail')[0].innerHTML;var email=lis[i].getElementsByClassName('contact-detail')[1].innerHTML;if(name.toUpperCase().indexOf(filter)>=0||email.toUpperCase().indexOf(filter)>=0){lis[i].style.display='list-item';hasResult=true;}
else{lis[i].style.display='none';}}
if(hasResult){$('#empty-message').addClass('hide');}else{$('#empty-message').removeClass('hide');}};};obj.importContact=function(){$(".import-process").click(function(){$("input:checkbox[name=import-cb]:checked").each(function(){if(emailsAdded.indexOf($(this).val())<0){emailsAdded.push($(this).val());obj.removeContactImported($(this).val());}});generateList(emailsAdded);obj.close();});};obj.removeContactImported=function(email){document.getElementById(email).remove();};obj.generateListContact=function(){if(data){for(var ent in data.feed.entry){for(var em in data.feed.entry[ent].gd$email){var email=data.feed.entry[ent].gd$email[em].address;var name=data.feed.entry[ent].title.$t;if(!name.length){name=email;}
if(googleEmailContacts.indexOf(email)<0&&emailsAdded.indexOf(email)<0){googleEmailContacts.push(email);var html='<li class="col-sm-12 col-xs-12 contact-item" id="'+email+'">'+
'<label class="checkbox-label"> '+
'<div class="contact-row row row-space-2">'+
'<div class="col-sm-6 col-xs-6">'+
'<div class="contact-checkbox-wrapper">'+
'<input class="contact-checkbox" name="import-cb" type="checkbox" value="'+email+'">'+
'</div>'+
'<strong class="contact-detail">'+name+'</strong>'+
'</div>'+
'<div class="contact-email contact-detail text-right col-sm-6 col-xs-6 text-mu">'+email+'</div>'+
'</div>'+
'</label>'+
'</li>';list$.append($(html));}}}
obj.checkBoxChange();obj.checkAll();obj.searchContact();obj.importContact();}else{$('#no-contact-found-message').removeClass('hide');}};obj.init();return obj;}
return modalCls;}(window.fiuzu.ui.Modal));$(document).ready(function(){var input$;var clientId=window.googleAppId;var apiKey=window.googleAppSecret;var scopes='https://www.googleapis.com/auth/contacts.readonly';var client=new ZeroClipboard($('#btn-copy'));client.on("ready",function(readyEvent){this.on("aftercopy",function(event){console.log("Copied text to clipboard: "+event.data["text/plain"]);var btn$=$('#btn-copy');btn$.find('i').hide();btn$.find('.mark').show().removeClass('hidden').css('color','#00ba7c');btn$.find('span').text('Done')});});$('#id_referal_url').click(function(){$(this).select();});$('.btn-facebook').click(function(){var url=$(this).attr('data-url');var picture=$(this).attr('data-picture');var name=$(this).attr('data-name');var caption=$(this).attr('data-caption');var description=$(this).attr('data-text');FB.ui({method:'feed',link:url,picture:picture,name:name,caption:caption,description:description,},function(resp){if(resp&&resp.post_id){mixpanel.track("Referal.share.FB ",{"Action":"Clicked Share FB "+url});}else{var MSG_SHARE_FAILED='This link has not been shared successfully ! <br/> Please try again !';alert(MSG_SHARE_FAILED);}});});twttr.ready(function(){loadTwitterButton();});var ggNum=0;$('.btn-google').each(function(){ggNum++;var ggUrl=$(this).attr('data-url'),ggCallback=function(resp){if(resp&&resp.type=="confirm"){}};var newInnerId="btn-google-inner-"+ggNum;$(this).append($('<div id="'+newInnerId+'" class="inner"></div>'))
gapi.plusone.render(newInnerId,{onendinteraction:ggCallback,href:ggUrl,annotation:'none',width:200,height:60,expandTo:'top,right,bottom,left'});$(this).find('.inner').css({top:3,left:3});});if(!fiuzu.session.isMobile){$(".btn-simulate").mouseover(function(e){var parentOffset=$(this).parent().offset(),relX=e.pageX-parentOffset.left,relY=e.pageY-parentOffset.top;$(this).find('iframe').css({top:relY-10,left:relX-20});$(this).find('.inner').css({top:relY-10,left:relX-20});});}
$('.btn-google, .btn-twitter').click(function(e){var social=$(this).attr('data-social'),url=$(this).attr('data-url'),text=$(this).attr('data-text');var callback=function(win){if(social=='twitter'){}else if(social=='google-plus'){}};fiuzu.utils.shareOn(social,url,{description:text,callback:callback});if(social=='twitter'){mixpanel.track("Referal.share.twitter ",{"Action":"Clicked Share twitter "+url});}else if(social=='google-plus'){mixpanel.track("Referal.share.google ",{"Action":"Clicked Share google "+url});}});$('.modal').each(function(){var modal=this;$(this).find('.close, .btn-close, .cancel').click(function(){$(modal).hide();});});input$=$("#id_email_add");$('.btn-add').click(function(e){var e=input$.val().replace(',','').replace(';','');if(checkEmail(e)){if(emailsAdded.indexOf(e)<0){emailsAdded.push(e);}
generateList(emailsAdded);input$.val("").focus();}else{input$.val(e);}});$('.btn-send-invitation').click(function(e){$("input:checkbox[name=emails_checked]:checked").each(function(){emailsChecked.push($(this).val());});var emailList=emailsChecked.join(",");if(emailsChecked.length>0){fiuzu.utils.loader.loading("Sending ...");$.ajax({url:'/api/account/invite-join/',data:JSON.stringify({emails:emailList,}),contentType:'application/json',dataType:'json',type:'POST',success:function(resp){fiuzu.utils.loader.loaded();if(resp['registed'].length>0){var strResult=resp['registed'][0]+' already registed';alert(strResult);}else{alert("All emails has been sent!");}},error:function(xhr){fiuzu.utils.loader.loaded();alert("Error happend. Please contact admin for more information !");}});}else{input$.focus();}});$('.btn-import').click(function(){gapi.client.setApiKey(apiKey);window.setTimeout(authorize(clientId,scopes));});$('.btn-join').click(function(){fiuzu.common.decorator.loginRequired(function(){location.reload();});});});