"use strict";function shareFbFitness(){return false;}
$(function(){var windowHeight=$(window).height();var i,j,lenIti;var lenDay=window.currentItinerary.length;var modalEmailFriend=new FModalEmailFriend($("#modal-email-friend"),{user:fiuzu.session.user});var city=window.city,planId=window.planId,markers=window.markers,currentItinerary=window.currentItinerary,planPDFUrl=window.planPDFUrl,dayIti=window.dayIti,dayMaps=window.dayMaps,dayNav=window.dayNav;modalEmailFriend.city=city;modalEmailFriend.planID=planId;$("#btn-email-itinerary, #btn-email-itinerary-mobile").click(function(){modalEmailFriend.show();$("div.modal-backdrop").removeClass("modal-backdrop");});$("#btn-plan-clone-mobile").click(function(){$(".box-login").addClass("mb-0");})
$(".view-on-map").click(function(){var day=$(this).attr("data-day"),index=$(this).attr("data-index");if(day&&index){markers[day-1][index-1].zoom();}});var map;for(i=1;i<=lenDay;i++){dayIti=currentItinerary[i-1].day_path;if(dayIti.length){map=new fiuzu.map.Map({canvas:$("#list-map-"+i),city:city,scrollwheel:false,currentDay:i});dayMaps.push(map);}else{dayMaps.push(null);}}
var plan=new fiuzu.common.models.Plan({id:planId});if($(window).width()>480){var placeFrm,placeTo;for(i=0;i<lenDay;i++){markers[i]=[];if(dayMaps[i]){dayIti=currentItinerary[i].day_path;try{dayMaps[i].init();}catch(err){continue;}
lenIti=dayIti.length;var itiDay,itiItem,model,places=[];currentItinerary[i].plan=plan;itiDay=new fiuzu.common.models.ItineraryDay(currentItinerary[i]);placeFrm=null;placeTo=null;for(j=0;j<lenIti;j++){if(dayIti[j].place){placeTo=dayIti[j].place;dayIti[j].plan=plan;dayIti[j].itineraryDay=itiDay;itiItem=new fiuzu.common.models.ItineraryItem(dayIti[j]);model=new fiuzu.common.models.Place(dayIti[j].place);var inLink='place-no-'+(i+1)+'-'+(j+1);model._item=itiItem;model._item.set('day',(i+1));markers[i][j]=dayMaps[i].createPlaceMarker(model,inLink);markers[i][j].setInLink('#'+inLink);places.push(model);if(placeTo&&placeFrm){dayMaps[i].getRouting(itiItem,placeFrm,placeTo,{mode:dayIti[j].route_mode,show:true});}
if(placeTo){placeFrm=placeTo;}}}
dayMaps[i].fitBoundsForPlaces(places);}}}
if(window.windowSize>fiuzu.WINDOW_SIZE_SM){$('body').scrollspy({target:'.iti-day-nav'});$(window).scroll(function(){var sTop=$(window).scrollTop();var $heightSucribe=$('#subcribe-top').height();var heightScroll=$heightSucribe+200;if(fiuzu.cookie.get('no_thanks_subcribe')=='1'){heightScroll=windowHeight;}
if(sTop<heightScroll){dayNav.addClass('hidden');}else{dayNav.removeClass('hidden').addClass('pos-fixed');}});}
var newsletterOpts=function(afterSubmit){return{classId:'modal-newsletter',url:'/account/modal/newsletter',method:'POST',mutiple:true,params:{description:'We will send PDF file to you email address. Please leave your email here !',title:'Download itinerary detail'},callbacks:{afterSubmit:afterSubmit}};};var authentication=new fiuzu.common.models.Authentication();$('#btn-plan-print').click(function(){var opts=newsletterOpts(function(email){window.print();});if(authentication.isAuthenticated()){window.print();}else{fiuzu.utils.loadModal(opts);}});$('#btn-plan-pdf').click(function(){fiuzu.pdf.downloadPDF(window.planId,window.planName,true);});$('.btn-plan-delete').click(function(){var cfm=confirm('Are you sure to delete this plan ?');if(cfm){var id=$(this).attr("data-id");var plan=new fiuzu.common.models.Plan({id:id});plan.destroy({success:function(model,resp){alert("The plan was deleted successfully !");window.location.href='/u/'+fiuzu.session.user.username+'/plans';},error:function(model,resp){alert("Cannot delete this plan !");}});}});var $tplComment=$('#tpl-comment');$('.module-social').each(function(){var moduleSocialView=new fiuzu.common.views.ModuleCommentView($(this),$tplComment);});$('.btn-plan-sharing-setting').each(function(){var btn$=$(this),planId=btn$.attr('data-id'),plan=new fiuzu.common.models.Plan({id:planId});$(this).find('li a').click(function(){var setting=$(this).attr('data-value'),sel$=$(this);plan.save({sharing_setting:setting},{patch:true,success:function(model){btn$.find('.dropdown-toggle').html(sel$.html());}});});});$('.btn-booktransfer').each(function(){var btn$=$(this);var pFrom=$(this).attr('data-place-from'),pTo=$(this).attr('data-place-to');$(this).click(function(){if(pFrom&&pTo){var opts={classId:'modal-booking-available-transfer',url:'/booking/modal/service/available/transfer?place_from='+pFrom+'&place_to='+pTo,method:'GET',multiple:true};fiuzu.utils.loadModal(opts);}});$(this).on('fz.btn.addedtocart',function(){$.ajax({url:'/api/route?origin='+pFrom+'&destination='+pTo+'&mode=driving',success:function(resp){if(resp.service){var mod=fiuzu.booking.models.BookingStatus;btn$.attr('data-serviceid',resp.service.id);fiuzu.booking.utils.checkServiceStatus("transfer",resp.service.id,function(re){if(re.status==mod.STATUS_IN_CART||re.status==mod.STATUS_IN_CART_CONFIRMED){btn$.addClass('btn-added').find('span').text('ADDED');}});}}});}).trigger('fz.btn.addedtocart');});});