(function($){"use strict";var WIDTH_MD=768;var WIDTH_LG=1024;var KEY_LEFT=37;var KEY_UP=38;var KEY_RIGHT=39;var KEY_DOWN=40;var KEY_ENTER=13;var KEY_ESCAPE=27;var windowWidth=$(window).width();var placeInfo;var xhr,xhrTotal;var mustgos=[];var cityPage=1;var dateRendered=false;var $loading=$('.loader-box').hide();var listDestinationBox=[];var rowOfColumn=0;var countColumn=0;var destinationClass="";var countCountryEndColumn=0;var freeRow=0;var count=0;var currentTags=[];var resultPlaces=[];var _itiParams=[];var currentCityId;if(window.options){currentCityId=options.city.id;}
$(document).mouseup(function(e){var destinationBox=$(".dialog-destination");if(!destinationBox.is(e.target)&&destinationBox.has(e.target).length===0){destinationBox.hide();$('#filter-destination-plan .typeahead').attr('placeholder','Destination');}});if(window.options){getCityPlace(options.cityId);}
$(document).ready(function(){keySelectDestinationBox();renderTravelInterest();renderDestinationBox();initFormControls();searchDestinationBox();renderDatePicker();renderTravelInterest();initModalWizard();clickEvent();checkItineraryAdded();})
function capitalize(string){return string.charAt(0).toUpperCase()+string.substring(1).toLowerCase();}
function clickEvent(){var destinationInput=$('#filter-destination-plan .typeahead'),modalItinerary=$('#modal-itinerary');if(windowWidth>(WIDTH_MD-1)){var pathname=window.location.pathname;destinationInput.on('click',function(e){if(pathname.length>1)return;destinationInput.select();var heightScroll=$('.destination-box').height();e.preventDefault();$('html, body').animate({scrollTop:heightScroll},300);});}
$('#go-submit').on('click',function(){var valueCity=$('[name=trip_city_id]').val();if(!valueCity){destinationInput.click();}else{modalItinerary.modal();}});$('#btn-advanced').on('click',function(){var valueCity=$('[name=trip_city_id]').val();if(!valueCity){destinationInput.click();}else{$('#modal-planner').modal();}});$('#show-push').on('click',function(event){event.preventDefault();$('html, body').animate({scrollTop:$(".bg-create-plan").offset().top},500);});var loadingBox=$("#loading-box-planner");$('#btn-generate').on('click',function(e){e.preventDefault();e.stopPropagation();modalItinerary.modal('hide');loadingBox.removeClass('hidden');$(window).off('beforeunload');setTimeout(function(){document.createPlan.submit();},200);});$('#btn-generate-manual').click(function(e){e.preventDefault();e.stopPropagation();var url="/planner/"+$('[name=trip_slug]').val()+'?duration='+$('[name=trip_duration]').val();modalItinerary.modal('hide');loadingBox.removeClass('hidden');setTimeout(function(){window.location=url;},200);});$('#btn-trip-idea').click(function(e){e.preventDefault();e.stopPropagation();var city=$('[name=trip_city_id]').val();var duration=$('[name=trip_duration]').val();var budget=$('[name=trip_max_budget]').val();var tags=$('[name=trip_tags]').val();var startDate=$('[name=trip_date]').val();var subUrl='?city='+city+'&duration='+duration+'&budget='+budget+'&tags='+tags+'&start='+startDate;var url="/plan/quotation/new"+subUrl;modalItinerary.modal('hide');loadingBox.removeClass('hidden');setTimeout(function(){window.location=url;},200);});}
function renderDatePicker(){var nowDate=new Date();var today=new Date(nowDate.getFullYear(),nowDate.getMonth(),nowDate.getDate(),0,0,0,0);var flightBox$=$('#flight_info');var hotelBox$=$('#hotel_info');var $tagInterest=$('#filter-tags-plan');var dFromFlight$=flightBox$.find('.date-start');var dToFlight$=flightBox$.find('.date-end');var tFromFlight$=flightBox$.find('.time-start');var tToFlight$=flightBox$.find('.time-end');var dFromHotel$=hotelBox$.find('.date-start');var dToHotel$=hotelBox$.find('.date-end');var tFromHotel$=hotelBox$.find('.time-start');var tToHotel$=hotelBox$.find('.time-end');var $fromDate=$('#from-date-format');var $inputHiddenDate=$('[name=trip_date]');var timeDefaultConfig={defaultTime:'12:00',showMeridian:false,disableFocus:true,showInputs:true};$('#modal-planner').on('shown.bs.modal',function(){if(!dateRendered){fiuzu.utils.initDateRange(dFromFlight$,dToFlight$);fiuzu.utils.initDateRange(dFromHotel$,dToHotel$);tFromFlight$.timepicker(timeDefaultConfig);tToFlight$.timepicker(timeDefaultConfig);tFromHotel$.timepicker(timeDefaultConfig);tToHotel$.timepicker(timeDefaultConfig);dateRendered=true;}});$fromDate.datepicker({startDate:"today",autoclose:true,todayHighlight:true,format:'yyyy-mm-dd',}).on('changeDate',function(e){if(!$tagInterest.find('select').selectpicker('val')){$tagInterest.find('.btn-default').click();}
$inputHiddenDate.val($(this).val());$(this).datepicker('hide');mixpanel.track("Selected Calendar "+$(this).val(),{"Action":"Clicked Calendar "+$(this).val()});fiuzu.cookie.set('create_plan_date',$(this).val());});if(fiuzu.cookie.get('create_plan_date')){$fromDate.datepicker('setValue',fiuzu.cookie.get('create_plan_date'));$inputHiddenDate.val(fiuzu.cookie.get('create_plan_date'));}}
function renderTravelInterest(){var tagsSel$=$('#filter-tags-plan select');if(/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)){tagsSel$.selectpicker('mobile');}else{tagsSel$.selectpicker();$('#filter-tags-plan').find('.bs-searchbox .form-control').addClass('icon-search');}
tagsSel$.change(function(){$('[name=trip_tags]').val(tagsSel$.val());});if(window.options){if(options.current_city_tags){currentTags=options.current_city_tags;setCurrentTags();}
if(options.cityId){selectCity(options.city);}}}
function renderDestinationBox(){$.each(allCountries,function(){var country=this;listDestinationBox.push('<li class="country" data-country="'+
country+'">'+country+'</li>');$.each(allCities,function(index,itemDestinationCity){var nameCountry=itemDestinationCity.country_name,id=itemDestinationCity.id;if(nameCountry==country){var city=itemDestinationCity.name;listDestinationBox.push('<li class="city" data-country="'+
nameCountry+'"><a data-id="'+id+'" value="'+
city+'" data-city="'+
city+'" class="mixpanel-obj" data-action="click" data-params="" data-mx-name="Search.Destination" href="#">'+city+'</a></li>');}});});showDestinationBox(listDestinationBox,1);$('#filter-destination-plan input').on('click',function(event){event.preventDefault();$(this).focus();$(this).attr("placeholder","");$('.dialog-destination').show();});$('#filter-destination-plan .close').click(function(){$('#filter-destination-plan input').attr("placeholder","Destination");$('.dialog-destination').hide();});}
function calculatorRowsColumns(list){var maxColumn=6;if(count<91){rowOfColumn=15;}else{rowOfColumn=count/maxColumn;rowOfColumn=parseInt(rowOfColumn+"");if((count%maxColumn)>0){rowOfColumn+=1;}}
if((count/15)>5){countColumn=maxColumn;destinationClass='2';}else{countColumn=parseInt(""+(count/15));if((count%15)>0){countColumn++;}
if(countColumn===5){countColumn=maxColumn;}}
for(var i=1;i<7;i++){if(countCountryEndColumn>=17){return countCountryEndColumn;}
if(rowOfColumn*i>=list.length){return;}else if(list[(rowOfColumn*i)-countCountryEndColumn].indexOf('class="country"')>0){countCountryEndColumn++;}}
freeRow=rowOfColumn-(count%rowOfColumn);if(freeRow===rowOfColumn){freeRow=0;}else if(countCountryEndColumn>freeRow){count=count+countCountryEndColumn;calculatorRowsColumns(list);}}
function showDestinationBox(list,myCase){var $listDestination=$('#list-destinations');var $searchDestination=$('#search-destinations');count=list.length;calculatorRowsColumns(list);destinationClass=""+(12/countColumn);var widthDestinationBox=970/(6/countColumn);if(windowWidth<980){widthDestinationBox='100%';$('#list-destinations, #search-destinations').css({overflowX:'hidden',overflowY:'scroll',maxHeight:500});}else{$('#list-destinations, #search-destinations').css({overflowY:'hidden'});}
if(widthDestinationBox<200){widthDestinationBox=200;}
$('.dialog-destination').css('width',widthDestinationBox);var countRowOfColumn=0;var str="";$.each(list,function(index,obj){if((countRowOfColumn%rowOfColumn)===rowOfColumn-1){if(obj.indexOf('class="country"')>0){str+='</ul>';countRowOfColumn=1;str+='<ul class="list-unstyled col-lg-'+destinationClass+' col-md-'+destinationClass+'">';str+=obj;return;}}
if(countRowOfColumn%rowOfColumn===0){str+='<ul class="list-unstyled col-lg-'+destinationClass+' col-md-'+destinationClass+'">';}
str+=obj;if((countRowOfColumn%rowOfColumn)===rowOfColumn-1){str+='</ul>';}
if((countRowOfColumn===list.length-1)&&(countRowOfColumn%rowOfColumn)!=rowOfColumn-1){str+='</ul>';}
countRowOfColumn++;});if(myCase===1){$listDestination.html(str);$listDestination.find('ul li:last-child').addClass('last');$listDestination.find('ul .city:first').addClass('first');}else{$searchDestination.html(str);$searchDestination.removeClass('hidden');$searchDestination.find('ul li:last-child').addClass('last');$searchDestination.find('ul .city:first').addClass('first');}}
function searchDestinationBox(){var $headerDestination=$('.destination-box-header h4');$('#filter-destination-plan input').keyup(function(e){var arrowKey=e.keyCode;if(arrowKey==KEY_LEFT||arrowKey==KEY_UP||arrowKey==KEY_RIGHT||arrowKey==KEY_DOWN||arrowKey==KEY_ENTER){return false;}else{var keySearch=$(this).val().replace(/\s+/g,'').toLowerCase().trim();var listSearch=[];var listCountry=[];var listCity=[];$(listDestinationBox).each(function(index,obj){var countryNameSearch=obj.split('data-country="')[1].split('"')[0].toLowerCase().trim();if(obj.indexOf('class="city"')!=-1){var cityNameSearch=obj.split('data-city="')[1].split('"')[0].replace(/\s+/g,'').toLowerCase().trim();}
if(countryNameSearch){if(countryNameSearch.indexOf(keySearch)!=-1){if(obj.indexOf(capitalize(countryNameSearch))!=-1){listCountry.push(countryNameSearch);listCity.push(cityNameSearch);listSearch.push(obj);}}}
if(cityNameSearch){if(cityNameSearch.indexOf(keySearch)!=-1){if(listCountry.indexOf(countryNameSearch)!=-1){if(listCity.indexOf(cityNameSearch)!=-1){return;}else{listSearch.push(obj);}}else{listSearch.push('<li class="country" data-country="'+
capitalize(countryNameSearch)+'">'+capitalize(countryNameSearch)+'</li>');listCountry.push(countryNameSearch);listCity.push(cityNameSearch);listSearch.push(obj);}}}});if(listSearch.length===0){$headerDestination.addClass('hidden');listSearch.push('<div class="col-lg-12"><h4 class="text-center">No Results</h4></div>');}else{$headerDestination.removeClass('hidden');}
showDestinationBox(listSearch,2);$("#list-destinations").addClass('hidden');$("#list-destinations").children().html('');eventSelectDestination();}
e.preventDefault();});}
function setCurrentTags(){if(currentTags){var strTagID="",defaultTagID=[];$.each(currentTags,function(index,checkedTag){strTagID+=", "+checkedTag.id;defaultTagID.push(checkedTag.id);$('[name=trip_tags]').val(defaultTagID.join(","));});console.log(defaultTagID);$('.selectpicker').selectpicker('val',defaultTagID);}}
function addItinerary(){var ctrlMustGo$=$('.btn-plan-add');ctrlMustGo$.on('click',function(event){event.preventDefault();event.stopPropagation();var placeID=$(this).attr("data-value");var className='.place-'+placeID;if(!$(className).hasClass("added")){$(className).addClass("added").html("REMOVE FROM ITINERARY ");mustgos.push($(this).attr("data-value"));$("#input-filter-mustgo").val(mustgos.join(","));}else{$(className).removeClass("added").html("ADD TO ITINERARY");var item_remove=$(this).attr("data-value");mustgos=$.grep(mustgos,function(value){return value!=item_remove;});$("#input-filter-mustgo").val(mustgos.join(","));}
fiuzu.utils.mustGoDict(_itiParams,{cityId:currentCityId,mustGoDict:mustgos});fiuzu.cookie.set('_itiParams',JSON.stringify(_itiParams));$('#modal-planner .num-selected').text(mustgos.length);$('.place-selected .num-selected').text(mustgos.length);if(mustgos.length>1){$('.place-selected .place-select').text(' places');}});}
function viewMorePlace(desId,url){var $loadMoreButton=$('.load-more-place');$loadMoreButton.click(function(){$loading.show();getCityPlace(desId,url);});}
function getCityPlace(desId,urlMore){if(!desId)return;var url="";var $loadMoreButton=$('.load-more-place');var $listPlaces=$('#list-places');if(urlMore){url=urlMore;}else{url="/api/place/?city_id="+desId+"&category=1,2,5,9,14";}
xhrTotal&&xhrTotal.abort();xhrTotal=$.ajax({url:url,success:function(resp){resultPlaces.push(resp.results);if(resp.next){$loadMoreButton.removeClass('hidden');viewMorePlace(desId,resp.next);}else{$loadMoreButton.addClass('hidden');}
appendPlaces(resultPlaces,resp.count);$('#modal-planner .total-places').text(resp.count);$loading.hide();}});}
function appendPlaces(results,leng){var allResults=[];var res=[];var $listPlaces=$('#list-places');var $searchInput=$('.custom-search-input input');var $loadMoreButton=$('.load-more-place');var $advancedPlanning=$('#advanced-planning-place').html();if(!$advancedPlanning)return;var templateDOM=_.template($advancedPlanning,null,{variable:'places'});for(var k in results){allResults=allResults.concat(results[k]);}
if(allResults.length>=16&&allResults.length<leng){$loadMoreButton.removeClass('hidden');}else{$loadMoreButton.addClass('hidden');}
_.each(allResults,function(place,index){if(mustgos&&mustgos.length){_.each(mustgos,function(id,i){if(id==place.id){place.mustgos=true;}});}})
$listPlaces.html(templateDOM(allResults));$searchInput.keyup(function(){var resultSearch=[];var keySearch=$(this).val().toLowerCase();$listPlaces.children().hide();_.each(allResults,function(place,index){$loading.show();var placeName=place.name.toLowerCase();if(placeName.indexOf(keySearch)!=-1){_.each($listPlaces.children(),function(obj,i){if(obj.dataset.id==place.id){$(obj).show();}})
resultSearch.push(place);}});$loading.hide();if(keySearch==""){if(allResults.length>=leng){$loadMoreButton.addClass('hidden');}else{$loadMoreButton.removeClass('hidden');}
$('#modal-planner .total-places').text(leng);}else{$loadMoreButton.addClass('hidden');$('#modal-planner .total-places').text(resultSearch.length);}});var ctrlMustGo$=$('.btn-plan-add');ctrlMustGo$.off('click',addItinerary());addItinerary();}
function selectCity(data){var $filterBudgetValue=$('#filter-budget-plan .dropdown-budget a');var valueBudget=[100,200,300];var desId=data.id;var str="";if(!data&&window.options&&options.city){data=options.city;}
mustgos=[];$("#input-filter-mustgo").val('');$('[name=trip_city_id]').val(desId);$('[name=trip_duration]').val(data.duration);$('.text-duration').html(data.duration+' days');$('[name=trip_max_budget]').val(data.budget_per_day);$('[name=trip_slug]').val(data.slug);var dataSelected=data.budget_per_day;$('.text-budget').html(dataSelected+' USD');if(valueBudget.indexOf(dataSelected)==-1){valueBudget.push(dataSelected);valueBudget.sort(function(a,b){return a-b;})}
for(var i=0;i<valueBudget.length;i++){var activeClass='';var value=valueBudget[i];if(valueBudget[i]===300){valueBudget[i]='200+';}
if(valueBudget[i]===dataSelected){activeClass='active';}
str+='<li class="'+activeClass+'"><a data-action="click" data-params="" data-mx-name="Select '+valueBudget[i]+' USD budget" data-value="'+value+'">'+valueBudget[i]+' USD</a></li>';}
str+='<li><a data-action="click" data-params="" data-mx-name="Select Any USD budget" data-value="-1">Any</a></li>';$('#filter-budget-plan .dropdown-budget').html(str);selectBudget();var strTagID="";var defaultTagID=[];var defaultTagValue=data.tags;$.each(defaultTagValue,function(index,checkedTag){strTagID+=", "+checkedTag.id;defaultTagID.push(checkedTag.id);$('[name=trip_tags]').val(defaultTagID.join(","));});$('.selectpicker').selectpicker('val',defaultTagID);}
function initFormControls(){var createPlan$=$(document.createPlan);var $desInput=$('#filter-destination-plan .typeahead');var ctrlDes$=createPlan$.find('#filter-destination-plan');ctrlDes$.find('.sprite').on('click',function(){if($desInput.attr('disabled'))return;ctrlDes$.find('input').click();});var ctrlDuration$=createPlan$.find('#filter-duration-plan');ctrlDuration$.find('li a').on('click',function(){createPlan$[0].trip_duration.value=$(this).attr('data-value');ctrlDuration$.find('.text-duration').text($(this).text());$(this).parent().addClass('active').siblings().removeClass('active');});selectDate();selectBudget();$('#btn-finish').on('click',function(e){e.preventDefault();$('#modal-planner').modal('hide');$('#loading-box-planner').removeClass('hidden');setTimeout(function(){document.createPlan.submit();},200);});eventSelectDestination();}
function selectDate(){var createPlan$=$(document.createPlan);var ctrlDate$=createPlan$.find('#filter-from-day-plan');ctrlDate$.find('.sprite').on('click',function(){ctrlDate$.find('input').focus();});}
function selectBudget(createPlan$){var createPlan$=$(document.createPlan);var ctrlBudget$=createPlan$.find('#filter-budget-plan');ctrlBudget$.find('li a').on('click',function(){createPlan$[0].trip_max_budget.value=$(this).attr('data-value');ctrlBudget$.find('.text-budget').text($(this).text());$(this).parent().addClass('active').siblings().removeClass('active');});}
function keySelectDestinationBox(){var checkFlagDown=0,checkFlagUp=0;if(windowWidth>WIDTH_LG){$('.typeahead').on('keyup',function(e){switch(e.which){case KEY_LEFT:$('.destination-box .city.active').removeClass('active').parent().prev().find('.city').eq(0).addClass("active");$(this).val($('.destination-box .city.active').text());if($('.destination-box .city.active').hasClass('first')){checkFlagUp=1;}
if($('.destination-box .city.active').hasClass('first')){checkFlagDown=0;}
break;case KEY_UP:if(checkFlagUp===1){$('.destination-box .city.active').removeClass('active').parent().prev().find('.city:last-child').addClass("active");$(this).val($('.destination-box .city.active').text());if($('.destination-box .city.active').hasClass('last')){checkFlagDown=1;}
return checkFlagUp=0;}
if(checkFlagUp===0){$('.destination-box .city.active').eq(0).removeClass("active").prevAll('.city').eq(0).addClass("active");$(this).val($('.destination-box .city.active').text());if($('.destination-box .city.active').hasClass('first')){checkFlagUp=1;}
return checkFlagDown=0;}
break;case KEY_RIGHT:$('.destination-box .city.active').removeClass('active').parent().next().find('.city').eq(0).addClass("active");$(this).val($('.destination-box .city.active').text());if($('.destination-box .city.active').hasClass('first')){checkFlagUp=1;}
if($('.destination-box .city.active').hasClass('first')){checkFlagDown=0;}
break;case KEY_DOWN:var listCityActive=$('.destination-box .city.active').length,cityActived="",coutryNext="";if(checkFlagDown===1){$('.destination-box .city.active').removeClass('active').parent().next().find('.city').eq(0).addClass("active");$(this).val($('.destination-box .city.active').text());if($('.destination-box .city.active').hasClass('first')){checkFlagUp=1;}
return checkFlagDown=0;}
if(listCityActive===0){$(".destination-box").find('.city').eq(0).addClass("active");cityActived=$('.destination-box .city.active');$(this).val(cityActived.text());}else{$('.destination-box .city.active').eq(0).removeClass("active").nextAll('.city').eq(0).addClass("active");cityActived=$('.destination-box .city.active');$(this).val(cityActived.text());if(cityActived.hasClass('last')){checkFlagDown=1;}
checkFlagUp=0;}
break;case KEY_ESCAPE:$(".dialog-destination").hide();$('#filter-destination-plan .typeahead').blur().attr("placeholder","Destination");break;default:return;}
e.preventDefault();})}}
function eventSelectDestination(){var filterDestination=$('#filter-destination-plan .typeahead');var $numSelected=$('.place-info .num-selected');if(windowWidth>WIDTH_LG){filterDestination.on('keyup',function(e){var cityActived=$('.destination-box .city.active'),cityActivedID=cityActived.children().attr("data-id"),idCity=cityActivedID,keyValue=e.keyCode;if(!idCity){idCity=$('.destination-box .city').eq(0).children().attr("data-id");}
if(keyValue===KEY_ENTER){$('.dialog-destination').hide();}
if(keyValue===KEY_LEFT||keyValue===KEY_UP||keyValue===KEY_RIGHT||keyValue===KEY_DOWN){if($('.destination-box .city.active').length!==0){setValueDestination(idCity,e);}}})}
$('.city a').on('click',function(e){var $selectDate=$('#from-date-format');var $inputHiddenDate=$('[name=trip_date]');var $tagInterest=$('#filter-tags-plan');$('.dialog-destination').hide();$('.destination-box .city.active').removeClass('active');$(this).parent().addClass('active');var idCity=$(this).data("id");setValueDestination(idCity,e);if(!$inputHiddenDate.val()||$inputHiddenDate.val()==0){$selectDate.datepicker('show');}
if($inputHiddenDate.val()&&!$tagInterest.find('select').selectpicker('val')){if($inputHiddenDate.val()==0)return;e.preventDefault();e.stopPropagation();$tagInterest.find('.btn-default').click();}
$numSelected.text('0');resultPlaces=[];});}
function setValueDestination(idCity,e){var data={};var params={url:location.href};params.name=$(this).attr("data-mx-name");params.params=$(this).attr("data-params");mixpanel.track(e.type,params);$.each(allCities,function(index,obj){if(idCity==obj.id){data.id=obj.id;data.name=obj.name;data.country_name=obj.country_name;data.duration=obj.duration;data.budget_per_day=obj.budget_per_day;data.tags=obj.tags;data.slug=obj.slug;data.count=obj.count;}});currentCityId=Number(idCity);getCityPlace(idCity);selectCity(data);$('#filter-destination-plan .typeahead').val(data.name);}
function initModalWizard(){var DemoFormWizard=function(){var o=this;$(document).ready(function(){o.initialize();});};var p=DemoFormWizard.prototype;p.initialize=function(){this.initWizard();};p.initWizard=function(){var o=this,wizard=$('#rootwizard');if(wizard.hasClass('form-wizard')){wizard.bootstrapWizard({onTabShow:function(tab,navigation,index){o.handleTabShow(tab,navigation,index,$('#rootwizard'));}});}};p.handleTabShow=function(tab,navigation,index,wizard){var total=navigation.find('li').length;var current=index+0;var percent=(current/(total-1))*100;var percentWidth=100-(100/total)+'%';var wizard=$('#rootwizard');navigation.find('li').removeClass('done');navigation.find('li.active').prevAll().addClass('done');wizard.find('.progress-bar').css({width:percent+'%'});$('.form-wizard-horizontal').find('.progress').css({'width':percentWidth});if(current>=1){wizard.find('.pager .previous').removeClass('hidden');wizard.find('.pager .previous').removeClass('disabled');}else{wizard.find('.pager .previous').addClass('hidden');}
if(current>=2){wizard.find('.progress-bar').removeClass('progress-bar-primary');}else{}
if(current>=total-1){wizard.find('.pager .next').hide();wizard.find('.pager .finish').show();wizard.find('.pager .finish').removeClass('disabled');}else{wizard.find('.pager .next').show();wizard.find('.pager .finish').hide();}};var aWizard=new DemoFormWizard();}
function checkItineraryAdded(){var listPlaces=$('#list-top-places').children('.city-item__place');var $btnExplore=$('.btn__explore');var cookieAdded=fiuzu.cookie.get('_itiParams');var mustGoDict;var mustGoCityId=[];if(cookieAdded){_itiParams=JSON.parse(cookieAdded);}
if(_itiParams&&_itiParams.length){var len=_itiParams.length;for(var i=0;i<len;i++){var cityId=_itiParams[i].cityId;mustGoCityId.push(cityId);if(cityId===currentCityId){mustGoDict=_itiParams[i].mustGoDict;for(var j=0;j<mustGoDict.length;j++){var placeItem='.place-id-'+mustGoDict[j];var btnAdd='.place-'+mustGoDict[j];$(placeItem).removeClass('hidden');$(btnAdd).addClass('added').html("REMOVE FROM ITINERARY");mustgos.push(mustGoDict[j]);$("#input-filter-mustgo").val(mustgos.join(","));}
if(mustGoDict.length<12){var lenPlaces=listPlaces.length;for(var j=0;j<lenPlaces;j++){var placeId=$(listPlaces[j]).data('id');if(mustgos.indexOf(placeId)==-1&&listPlaces.not('.hidden').length<12){var remainItem='.place-id-'+placeId;$(remainItem).removeClass('hidden');}}}
$('.num-selected').text(mustGoDict.length);if(mustGoDict.length>1){$('.place-select').text(' places');}}}}
if(!_itiParams||mustGoCityId.indexOf(currentCityId)==-1){for(var i=0;i<12;i++){$(listPlaces[i]).removeClass('hidden');}}
var $numPlaces=$('.num_places');$numPlaces.text(listPlaces.length);$btnExplore.on('click',function(){fiuzu.cookie.set('_hasIti',1);var countrySlug=$(this).data('countryslug');window.location='/place/'+countrySlug+'/'+options.city.slug;});}})(jQuery);